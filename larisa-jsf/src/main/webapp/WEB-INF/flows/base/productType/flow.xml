<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow http://www.springframework.org/schema/webflow/spring-webflow-2.4.xsd"
      start-state="list"
      parent="parent-flow">
    <var name="data" class="larisa.jsf.data.ProductTypeData"/>
    <var name="entity" class="larisa.entity.ProductType"/>
    <input name="price" type="larisa.entity.Price"/>
    <view-state id="list" view="list.xhtml">
        <transition on="edit" to="edit">
        </transition>
        <transition on="maker-edit" to="maker-edit">

        </transition>
        <transition on="price-edit" to="price-edit">

        </transition>
        <transition on="price-new" to="price-new">

        </transition>
        <transition on="outgo-new" to="outgo-new">

        </transition>
        <transition on="product-new" to="product-new">

        </transition>
        <transition on="prepare-delete">
        </transition>
        <transition on="delete" to="list">
            <evaluate expression="productTypeService.delete(entity)"/>
        </transition>
    </view-state>
    <subflow-state id="maker-edit" subflow="base/maker/edit">
        <input name="entity" value="entity.maker" required="true" type="larisa.entity.Maker"/>
        <transition on="edit-canceled" to="list"/>
        <transition on="edit-confirmed" to="list"/>
    </subflow-state>
    <subflow-state id="price-edit" subflow="base/price/edit">
        <input name="entity" value="priceService.findOne(entity)" required="true" type="larisa.entity.Price"/>
        <transition on="edit-canceled" to="list"/>
        <transition on="edit-confirmed" to="list"/>
    </subflow-state>
    <subflow-state id="price-new" subflow="base/price/edit">
        <input name="entity" value="priceService.createNewInstance(entity)" required="true" type="larisa.entity.Price"/>
        <transition on="edit-canceled" to="list"/>
        <transition on="edit-confirmed" to="list"/>
    </subflow-state>

    <subflow-state id="product-new" subflow="base/product/edit">
        <on-entry>
            <set name="requestScope.product" value="productService.createNewInstance()" type="larisa.entity.Product"/>
            <set name="requestScope.product.productType" value="entity" type="larisa.entity.ProductType"/>
        </on-entry>
        <input name="entity" value="requestScope.product" required="true" type="larisa.entity.Product"/>
        <transition on="edit-canceled" to="list"/>
        <transition on="edit-confirmed" to="list"/>
    </subflow-state>

    <subflow-state id="outgo-new" subflow="base/outgo/edit">
        <on-entry>
            <set name="requestScope.outgo" value="outgoService.createNewInstance()" type="larisa.entity.Outgo"/>
            <set name="requestScope.outgo.productType" value="entity" type="larisa.entity.ProductType"/>
        </on-entry>
        <input name="entity" value="requestScope.outgo" required="true" type="larisa.entity.Outgo"/>
        <transition on="edit-canceled" to="list"/>
        <transition on="edit-confirmed" to="list"/>
    </subflow-state>


    <subflow-state id="edit" subflow="base/productType/edit">
        <input name="entity" required="true" type="larisa.entity.ProductType"/>
        <transition on="edit-canceled" to="list"/>
        <transition on="edit-confirmed" to="list"/>
    </subflow-state>

    <global-transitions>
        <transition on="new" to="edit">
            <evaluate expression="productTypeService.createNewInstance()" result="entity"/>
        </transition>
    </global-transitions>
    
</flow>